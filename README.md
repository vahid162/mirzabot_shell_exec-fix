# mirzabot_shell_exec-fix# ๐ ุงููโุณุงุฒ `shell_exec` ุฏุฑ ุฑุจุงุช ูุฑุฒุง ูพูู

ุงุณฺฉุฑูพุช ุจุฑุง ุงููโุณุงุฒ ุฑุจุงุช `botmirzapanel` ุงุฒ ุทุฑู ูุฏุฑุช ุงูู ุชุงุจุน `shell_exec` ุจุฑุง ฺฉุฑูู ุฌุงุจโูุง.

ุงู ูพุฑูฺู ฺฉ ุงุณฺฉุฑูพุช ุจุฑุง ุญู ูุดฺฉู ุงููุช ุชุงุจุน `shell_exec` ุฏุฑ ุฑุจุงุชโูุง ูุจุชู ุจุฑ ยซูุฑุฒุง ูพููยป ุงุฑุงุฆู ูโุฏูุฏ. ุงู ุงุณฺฉุฑูพุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูุงูโูุง ูุงุงูู ุฑุง ุจุง ูุณุฎูโูุง ุงูู ุฌุงฺฏุฒู ฺฉุฑุฏู ู ุชูุธูุงุช ูุงุฒู ุฑุง ุฑู ุณุฑูุฑ ุงุนูุงู ูโฺฉูุฏ.

---

## ๐ ุฑุงูููุง ุดุฑูุน ุณุฑุน

ุจุฑุง ุญู ูุดฺฉู ุงููุช `shell_exec`ุ ูุทูุงู ูุฑุงุญู ุฒุฑ ุฑุง ุจู ุชุฑุชุจ ุงูุฌุงู ุฏูุฏ.

### ฑ. ูุฑูุฏ ุจู ุณุฑูุฑ ุดูุง
ุจู ุชุฑููุงู ุณุฑูุฑ ุฎูุฏ ูุชุตู ุดูุฏ (ูุนูููุงู ุงุฒ ุทุฑู **SSH**).

### ฒ. ุฑูุชู ุจู ูพูุดู ุฑุจุงุช
ุจุง ุฏุณุชูุฑ `cd` ุจู ูพูุดู ุฑุจุงุช ููุฑุฏ ูุธุฑ ุฎูุฏ ุจุฑูุฏ.

```bash
# ูุซุงู:
cd /www/wwwroot/your-domain.com/telegram_bot/bot_folder_name
```

### ณ. ุงุฌุฑุง ุงุณฺฉุฑูพุช ูุตุจ
ุฏุณุชูุฑ ุฒุฑ ุฑุง ฺฉูพ ฺฉุฑุฏู ู ุฏุฑ ุชุฑููุงู ุฎูุฏ ูพุณุช ฺฉูุฏ ู ุงูุชุฑ ุฑุง ุจุฒูุฏ. ุงุณฺฉุฑะฟั ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ููู ฺุฒ ุฑุง ูุฏุฑุช ูโฺฉูุฏ.

```bash
curl -sSL https://raw.githubusercontent.com/vahid162/mirzabot_shell_exec-fix/main/installer.sh | sudo bash
```


### ด. ุบุฑูุนุงู ฺฉุฑุฏู `shell_exec`
ุงู **ูููโุชุฑู ูุฏู ููุง** ุจุฑุง ุจุณุชู ุญูุฑู ุงููุช ุงุณุช.

ุณุฑูุฑ ุดูุง ุงฺฉููู ุงูู ู ฺฉุงููุงู ฺฉุงุฑุจุฑุฏ ุงุณุช!



**ุชุบุฑุงุช ุจู ุตูุฑุช ุฏุณุช**


# ุฑุงูููุง ฺฉุงูู ุงููโุณุงุฒ ุฑุจุงุช ุชูฺฏุฑุงู (botmirzapanel) ู ุชุงุจุน `shell_exec`

๐ ุงู ุฑุงูููุง ุจู ุดูุง ูุดุงู ูโุฏูุฏ ฺฉู ฺุทูุฑ ุชุงุจุน ุฎุทุฑูุงฺฉ `shell_exec` ุฑุง ุฏุฑ PHP ุบุฑูุนุงู ฺฉูุฏ ู ููุฒูุงู ุจู ุฑุจุงุช ุชูฺฏุฑุงู ุฎูุฏ ุงุฌุงุฒู ุฏูุฏ ุชุง ฺฉุงุฑูุง ูุฏุฑุช (ูุงููุฏ ุชูุธู ฺฉุฑููโุฌุงุจโูุง) ุฑุง ุจู ุดฺฉู ฺฉุงููุงู ุงูู ุงูุฌุงู ุฏูุฏ.

### **ูุดฺฉู ฺุณุชุ (The "Why")**

ุชุงุจุน `shell_exec` ุจู PHP ุงุฌุงุฒู ูโุฏูุฏ ุฏุณุชูุฑุงุช ุฑุง ูุณุชููุงู ุฑู ุณุฑูุฑ ูููฺฉุณ ุงุฌุฑุง ฺฉูุฏ. ุงฺฏุฑ ุงู ุชุงุจุน ูุนุงู ุจุงุดุฏ ู ฺฉ ูฺฉุฑ ุฑุงู ุจุฑุง ูููุฐ ุจู ฺฉุฏ ุดูุง ูพุฏุง ฺฉูุฏุ ูโุชูุงูุฏ ฺฉูุชุฑู ฺฉุงูู ุณุฑูุฑ ุฑุง ุจู ุฏุณุช ุจฺฏุฑุฏ. ุฑุงู ุญู ูุง ุงู ุงุณุช ฺฉู ุงู ุชุงุจุน ุฑุง ุฏุฑ PHP ุบุฑูุนุงู ฺฉููุ ุงูุง ุงุฒ ุทุฑู ฺฉ ุงุณฺฉุฑูพุช ูุงุณุท ุงูู ู ุจุง ุงุณุชูุงุฏู ุงุฒ `sudo` ุฏุฑ ูููฺฉุณุ ููุท ุจู ุฏุณุชูุฑุงุช ูุดุฎุต ฺฉู ุฑุจุงุช ูุงุฒ ุฏุงุฑุฏุ ุงุฌุงุฒู ุงุฌุฑุง ุจุฏูู.

### **ูพุดโูุงุฒูุง (Prerequisites)**

* ุฏุณุชุฑุณ ุจู ุชุฑููุงู ุณุฑูุฑ (ูุนูููุงู ุงุฒ ุทุฑู SSH).
* ุฏุณุชุฑุณ ุจู ฺฉุงุฑุจุฑ `root` ุง ฺฉุงุฑุจุฑ ุจุง ุฏุณุชุฑุณ `sudo`.
* ุฏุงูุณุชู ูุณุฑ ูุตุจ ุฑุจุงุช (ูุซูุงู: `/www/wwwroot/yourdomain.com/telegram_bot/your_bot_folder/`).
* ฺฉ ูุฑุงุดฺฏุฑ ูุชู ุฏุฑ ุชุฑููุงู ูุงููุฏ `nano`.

---

### **ูุฏู ุงูู: ุณุงุฎุช ุงุณฺฉุฑูพุช ูุงุณุท ุงูู (`cron_helper.sh`)**

ุงู ุงุณฺฉุฑูพุช ุจู ุนููุงู ฺฉ ุฏุฑูุงุฒูโุจุงู ุงูู ุนูู ูโฺฉูุฏ ู ููุท ุฏุณุชูุฑุงุช ูุฑุจูุท ุจู ฺฉุฑููโุฌุงุจ ุฑุง ุงุฌุฑุง ูโฺฉูุฏ.

1.  ุจุง ุฏุณุชูุฑ ุฒุฑุ ูุงู ุงุณฺฉุฑูพุช ุฑุง ุฏุฑ ูุณุฑ ุงุณุชุงูุฏุงุฑุฏ ู ุงูู `/usr/local/bin/` ุจุณุงุฒุฏ:
    ```bash
    sudo nano /usr/local/bin/cron_helper.sh
    ```

2.  ฺฉุฏ ุฒุฑ ุฑุง ุจู ุทูุฑ ฺฉุงูู ฺฉูพ ฺฉุฑุฏู ู ุฏุงุฎู ูุฑุงุดฺฏุฑ `nano` ูพุณุช (Paste) ฺฉูุฏ:
    ```bash
    #!/bin/bash
    # --- Secure Cron Job Helper Script ---
    # Allows adding or removing specific cron jobs safely.

    set -e

    ACTION=$1
    JOB_COMMAND="${@:2}" # Get all arguments starting from the second one

    # --- Basic Validation ---
    # Ensure the job command is a valid cron job starting with curl.
    if [[ "$ACTION" == "add" && ! "$JOB_COMMAND" =~ ^\*\/\d+\s+\*\s+\*\s+\*\s+\*\s+curl\s+https:\/\/.*$ ]]; then
        echo "Error: Invalid or insecure cron job command provided." >&2
        exit 1
    fi

    case "$ACTION" in
        add)
            (crontab -l 2>/dev/null | grep -vF -- "$JOB_COMMAND" ; echo "$JOB_COMMAND") | crontab -
            ;;
        remove)
            (crontab -l 2>/dev/null | grep -vF -- "$JOB_COMMAND") | crontab -
            ;;
        list)
            crontab -l
            ;;
        *)
            echo "Error: Invalid action. Use 'add', 'remove', or 'list'." >&2
            exit 1
            ;;
    esac

    exit 0
    ```

3.  ูุงู ุฑุง ุฐุฎุฑู ฺฉูุฏ. ุฏุฑ `nano`ุ ุจุง ุฒุฏู `Ctrl+X`ุ ุณูพุณ `Y` ู ุฏุฑ ุขุฎุฑ `Enter` ุงู ฺฉุงุฑ ุฑุง ุงูุฌุงู ุฏูุฏ.

---

### **ูุฏู ุฏูู: ุชูุธู ุฏุณุชุฑุณโูุง ุตุญุญ**

ุงู ุฏุณุชูุฑุงุช ุชุถูู ูโฺฉููุฏ ฺฉู ุงุณฺฉุฑูพุช ููุท ุชูุณุท ฺฉุงุฑุจุฑ ุฑุดู (`root`) ูุงุจู ุชุบุฑ ุงุณุช ู ุชูุณุท ฺฉุงุฑุจุฑ ูุจโุณุฑูุฑ ูุงุจู ุงุฌุฑุงุณุช.

```bash
sudo chown root:root /usr/local/bin/cron_helper.sh
sudo chmod 750 /usr/local/bin/cron_helper.sh
```

---

### **ูุฏู ุณูู: ุชูุธู ูุงููู `sudo`**

ุจู ฺฉุงุฑุจุฑ ูุจโุณุฑูุฑ (ูุนูููุงู `www-data` ุฏุฑ ุงูุจููุชู/ุฏุจุงู) ุงุฌุงุฒู ูโุฏูู ฺฉู ููุท ุงุณฺฉุฑูพุช ูุง ุฑุง ุจุฏูู ูุงุฒ ุจู ูพุณูุฑุฏ ุงุฌุฑุง ฺฉูุฏ.

1.  ุฏุณุชูุฑ ุฒุฑ ุฑุง ุจุฑุง ูุฑุงุด ุงูู ูุงู `sudoers` ูุงุฑุฏ ฺฉูุฏ:
    ```bash
    sudo visudo
    ```

2.  ุจุง ฺฉุจูุฑุฏ ุจู **ุงูุชูุง ูุงู** ุจุฑูุฏ ู ุงู ุฎุท ุฑุง ุฏููุงู ุงุถุงูู ฺฉูุฏ:
    ```
    www-data ALL=(root) NOPASSWD: /usr/local/bin/cron_helper.sh
    ```

3.  ูุงู ุฑุง ุฐุฎุฑู ฺฉุฑุฏู ู ุฎุงุฑุฌ ุดูุฏ (`Ctrl+X`ุ ุณูพุณ `Y` ู `Enter`).

---

### **ูุฏู ฺูุงุฑู: ุงุตูุงุญ ูุงูโูุง PHP ุฑุจุงุช**

๐ ุฏุฑ ุงู ูุฑุญููุ ฺฉุฏูุง ูุงุงูู ุฑุจุงุช ุฑุง ุจุง ูุฑุงุฎูุงูโูุง ุงูู ุจู ุงุณฺฉุฑูพุช ูุงุณุท ุฎูุฏูุงู ุฌุงฺฏุฒู ูโฺฉูู. ุงู ฺฉุงุฑ ุจุงุฏ ุจุฑุง ุชูุงู ูพูุดูโูุง ุฑุจุงุช ุชฺฉุฑุงุฑ ุดูุฏ.

#### **ุงูู) ุงุตูุงุญ `index.php`**

* **ูุงู ุฑุง ุจุงุฒ ฺฉูุฏ:** `nano /path/to/your_bot_folder/index.php`
* **ุงู ุจูุงฺฉ ฺฉุฏ ุฑุง ูพุฏุง ฺฉูุฏ (SEARCH FOR THIS):**
    ```php
    if (function_exists('shell_exec') && is_callable('shell_exec')) {
    $existingCronCommands = shell_exec('crontab -l');
    $phpFilePath = "https://$domainhosts/cron/sendmessage.php";
    $cronCommand = "*/1 * * * * curl $phpFilePath";
    if (strpos($existingCronCommands, $cronCommand) === false) {
        $command = "(crontab -l ; echo '$cronCommand') | crontab -";
        shell_exec($command);
    }
    }
    ```
* **ฺฉู ุจูุงฺฉ ุจุงูุง ุฑุง ุจุง ุงู ฺฉุฏ ุฌุงฺฏุฒู ฺฉูุฏ (REPLACE WITH THIS):**
    ```php
    if (function_exists('shell_exec') && is_callable('shell_exec')) {
        $phpFilePath = "https://{$domainhosts}/cron/sendmessage.php";
        $cronCommand = "*/1 * * * * curl {$phpFilePath}";
        shell_exec("sudo /usr/local/bin/cron_helper.sh add " . escapeshellarg($cronCommand));
    }
    ```

#### **ุจ) ุงุตูุงุญ `admin.php`**

* **ูุงู ุฑุง ุจุงุฒ ฺฉูุฏ:** `nano /path/to/your_bot_folder/admin.php`
* **ฑ. ุญุฐู ุจุฑุฑุณ ุงููู:** ุจูุงฺฉ ฺฉุฏ ุฒุฑ ุฑุง ฺฉู ูุนูููุงู ุฏุฑ **ุงุจุชุฏุง ูุงู** ุงุณุชุ ูพุฏุง ฺฉุฑุฏู ู **ฺฉุงูู ุญุฐู ฺฉูุฏ**:
    ```php
    // vvv DELETE THIS ENTIRE BLOCK vvv
    if(!(function_exists('shell_exec') && is_callable('shell_exec'))){
        $cronCommandsendmessage = "*/1 * * * * curl https://$domainhosts/cron/sendmessage.php";
        sendmessage($from_id, sprintf($textbotlang['Admin']['cron']['active_manual_sendmessage'],$cronCommandsendmessage),null, 'HTML');
    }
    ```
* **ฒ. ุญุฐู ุจุฑุฑุณ ุซุงููู (ุฏุงุฎู ููู ฺฉุฑููโุฌุงุจ):**
    * **ุงู ุจูุงฺฉ ฺฉุฏ ุฑุง ูพุฏุง ฺฉูุฏ (SEARCH FOR THIS):**
        ```php
        if ($text == $textbotlang['Admin']['keyboardadmin']['settingscron']) {
            if(!(function_exists('shell_exec') && is_callable('shell_exec'))){
                $crontest = "...";
                // ... (lines to build the error message)
                sendmessage($from_id, sprintf($textbotlang['Admin']['cron']['active_manual'],$crontest,$cronvolume,$crontime,$cronremove), null, 'HTML');
                return;
            }
            sendmessage($from_id, $textbotlang['users']['selectoption'], $keyboardcronjob, 'HTML');
        }
        ```
    * **ฺฉู ุจูุงฺฉ ุจุงูุง ุฑุง ุจุง ุงู ฺฉุฏ ุฌุงฺฏุฒู ฺฉูุฏ (REPLACE WITH THIS):**
        ```php
        if ($text == $textbotlang['Admin']['keyboardadmin']['settingscron']) {
            sendmessage($from_id, $textbotlang['users']['selectoption'], $keyboardcronjob, 'HTML');
        }
        ```
* **ณ. ุงุตูุงุญ ฺฉุฏูุง ูุนุงู/ุบุฑูุนุงูโุณุงุฒ ฺฉุฑููโุฌุงุจ:** ุฏุฑ ุงุฏุงูู ูุงู `admin.php`ุ ฺูุงุฑ ุจุฎุด ุจุฑุง ูุฏุฑุช ฺฉุฑููโุฌุงุจโูุง ูุฌูุฏ ุฏุงุฑุฏ. ุงูฺฏู ุงุตูุงุญ ุขููุง ฺฉุณุงู ุงุณุช.

    * **ุจุฑุง ูุนุงูโุณุงุฒ (ูุงููุฏ `configtest`):**
        * **ฺฉุฏ ูุจู:** `shell_exec($command);`
        * **ฺฉุฏ ุฌุฏุฏ:** `shell_exec("sudo /usr/local/bin/cron_helper.sh add " . escapeshellarg($cronCommand));`
    * **ุจุฑุง ุบุฑูุนุงูโุณุงุฒ (ูุงููุฏ `configtest`):**
        * **ุจูุงฺฉ ฺฉุฏ ฺูุฏุฎุท ูุจู ุฑุง ูพุฏุง ู ุญุฐู ฺฉูุฏ.**
        * **ฺฉุฏ ุฌุฏุฏ (ููุท ฺฉ ุฎุท):**
            ```php
            $jobToRemove = "*/15 * * * * curl https://$domainhosts/cron/configtest.php";
            shell_exec("sudo /usr/local/bin/cron_helper.sh remove " . escapeshellarg($jobToRemove));
            ```

    ุงู ุงูฺฏู ุฑุง ุจุฑุง ูุฑ ฺูุงุฑ ฺฉุฑููโุฌุงุจ (`test`, `volume`, `time`, `remove`) ุชฺฉุฑุงุฑ ฺฉูุฏ.

---

### **ูุฏู ูพูุฌู: ุบุฑูุนุงู ฺฉุฑุฏู ููุง `shell_exec`**

ุงู ุขุฎุฑู ู ูููโุชุฑู ูุฏู ุจุฑุง ุจุณุชู ุญูุฑู ุงููุช ุงุณุช.



---

### **ูุฏู ุดุดู: ุชุณุช ู ุชุฃุฏ ููุง โ**

1.  ูุงุฑุฏ ุฑุจุงุช ุชูฺฏุฑุงู ุฎูุฏ ุดุฏู ู ุจู ูพูู ุงุฏูู ุจุฑูุฏ.
2.  ุจู ุจุฎุด "ุชูุธูุงุช ฺฉุฑูู ุฌุงุจ" (`settingscron`) ุจุฑูุฏ. ุงู ุจุงุฑ ูุจุงุฏ ูพุงู ุฎุทุง ุจุจูุฏ ู ููู ูุฏุฑุช ุจุงุฏ ููุงุด ุฏุงุฏู ุดูุฏ.
3.  ฺฉ ุงุฒ ฺฉุฑููโุฌุงุจโูุง ุฑุง ูุนุงู ุง ุบุฑูุนุงู ฺฉูุฏ.
4.  ุงฺฏุฑ ูพุงู ููููุชโุขูุฒ ุฏุฑุงูุช ฺฉุฑุฏุฏุ ุนู ุชูุงู ูุฑุงุญู ุจู ุฏุฑุณุช ุงูุฌุงู ุดุฏู ุงุณุช.

๐ ุจุง ุงูุฌุงู ุงู ูุฑุงุญูุ ุฑุจุงุช ุดูุง ุงฺฉููู ูู ฺฉุงุฑุง ุฎูุฏ ุฑุง ุญูุธ ฺฉุฑุฏู ู ูู ุฏุฑ ุจุฑุงุจุฑ ุญููุงุช ูุฑุจูุท ุจู `shell_exec` ฺฉุงููุงู ุงูู ุดุฏู ุงุณุช.
